!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).aimapi={})}(this,(function(e){"use strict";function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n="AIMv4_3",i="DCM",a="20121129",o={"1.2.840.10008.5.1.4.1.1.2":{codeValue:"CT",codeMeaning:"Computed Tomography",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.1":{codeValue:"CR",codeMeaning:"Computed Radiography",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.128":{codeValue:"PT",codeMeaning:"Positron emission tomography",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.4":{codeValue:"MR",codeMeaning:"Magnetic Resonance",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.6.1":{codeValue:"US",codeMeaning:"Ultrasound",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.1.2":{codeValue:"MG",codeMeaning:"Mammography",codingSchemeDesignator:i,codingSchemeVersion:a},"1.2.840.10008.5.1.4.1.1.1.2.1":{codeValue:"MG",codeMeaning:"Mammography",codingSchemeDesignator:i,codingSchemeVersion:a},CT:{codeValue:"CT",codeMeaning:"Computed Tomography",codingSchemeDesignator:i,codingSchemeVersion:a},CR:{codeValue:"CR",codeMeaning:"Digital Radiography",codingSchemeDesignator:i,codingSchemeVersion:a},DX:{codeValue:"DX",codeMeaning:"Computed Radiography",codingSchemeDesignator:i,codingSchemeVersion:a},PT:{codeValue:"PT",codeMeaning:"Positron emission tomography",codingSchemeDesignator:i,codingSchemeVersion:a},MR:{codeValue:"MR",codeMeaning:"Magnetic Resonance",codingSchemeDesignator:i,codingSchemeVersion:a},US:{codeValue:"US",codeMeaning:"Ultrasound",codingSchemeDesignator:i,codingSchemeVersion:a},MG:{codeValue:"MG",codeMeaning:"Mammography",codingSchemeDesignator:i,codingSchemeVersion:a},"PET-CT":{codeValue:"RID10341",codeMeaning:"PET-CT",codingSchemeDesignator:"RADLEX",codingSchemeVersion:"4.1"},"PET-MR":{codeValue:"RID10342",codeMeaning:"PET-MR",codingSchemeDesignator:"RADLEX",codingSchemeVersion:"4.1"},"US-RF":{codeValue:"RID49581",codeMeaning:"US-RF",codingSchemeDesignator:"RADLEX",codingSchemeVersion:"4.1"}};function s(){let e="2.25."+Math.floor(1+9*Math.random());for(let t=0;t<38;t++)e+=Math.floor(10*Math.random());return e}class c{constructor(e,i,a,c=s()){let l;t(this,"getDate",(()=>{const e=new Date;return e.getFullYear()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2)+("0"+e.getHours()).slice(-2)+("0"+e.getMinutes()).slice(-2)+("0"+e.getSeconds()).slice(-2)})),t(this,"_createObject",((e,t)=>{var n={};return n[e]={value:t},n})),t(this,"_createDimension",((e,t=0,n=1)=>({Dimension:[Object.assign({},this._createObject("index",t),this._createObject("size",n),this._createObject("label",e))]}))),t(this,"_createDoubleDataType",(()=>({dataType:{code:"C48870",codeSystem:"NCI","iso:displayName":{"xmlns:iso":"uri:iso.org:21090",value:"Double"}}}))),t(this,"_createCalcResult",((e,t,n,i="")=>{var a=this._createObject("unitOfMeasure",e);return Object.assign(a,this._createDoubleDataType()),a["xsi:type"]="CompactCalculationResult",a.dimensionCollection=this._createDimension(i+t),a.type="Scalar",Object.assign(a,this._createObject("value",`${n}`)),a})),t(this,"_createTypeCode",((e="11203",t="DCM",n="Attenuation Coefficient")=>{var i={};return i.code=e,i.codeSystemName=t,i["iso:displayName"]={"xmlns:iso":"uri:iso.org:21090",value:n},i})),t(this,"createLengthCalcEntity",(e=>{const{unit:t,value:n}=e,i={},a=s();return i.uniqueIdentifier={root:a},i.typeCode=[this._createTypeCode("G-D7FE","SRT","Length")],i.description={value:"Length"},i.calculationResultCollection={CalculationResult:[this._createCalcResult(t,"LineLength",n)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(i),a})),t(this,"createLongAxisCalcEntity",(e=>{const{unit:t,value:n}=e,i={},a=s();return i.uniqueIdentifier={root:a},i.typeCode=[this._createTypeCode("G-A185","SRT","LongAxis")],i.description={value:"LongAxis"},i.calculationResultCollection={CalculationResult:[this._createCalcResult(t,"LongAxis",n)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(i),a})),t(this,"createShortAxisCalcEntity",(e=>{const{unit:t,value:n}=e,i={},a=s();return i.uniqueIdentifier={root:a},i.typeCode=[this._createTypeCode("G-A186","SRT","ShortAxis")],i.description={value:"ShortAxis"},i.calculationResultCollection={CalculationResult:[this._createCalcResult(t,"ShortAxis",n)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(i),a})),t(this,"createAreaCalcEntity",(e=>{const{unit:t,value:n}=e,i={},a=s();return i.uniqueIdentifier={root:a},i.typeCode=[this._createTypeCode("99EPADA4","99EPAD","Area")],i.description={value:"Area"},i.calculationResultCollection={CalculationResult:[this._createCalcResult(t,"Area",n)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(i),a})),t(this,"createVolumeCalcEntity",(e=>{const{unit:t,value:n}=e,i={},a=s();return i.uniqueIdentifier={root:a},i.typeCode=[this._createTypeCode("RID28668","Radlex","Volume")],i.description={value:"Volume"},i.calculationResultCollection={CalculationResult:[this._createCalcResult(t,"Volume",n)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(i),a})),t(this,"createMeanCalcEntity",((e,t)=>{let n,{unit:i,mean:a}=e;({unit:i,typeCodeDcm:n}=this._getAimUnitAndDcmTypeCode(i));var o={};const c=s();return o.uniqueIdentifier={root:c},o.typeCode=[n,this._createTypeCode("R-00317","SRT","Mean")],o.description={value:"Mean"},o.calculationResultCollection={CalculationResult:[this._createCalcResult(i,"Mean",a,t)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(o),c})),t(this,"createStdDevCalcEntity",((e,t)=>{let n,{unit:i,stdDev:a}=e;({unit:i,typeCodeDcm:n}=this._getAimUnitAndDcmTypeCode(i));var o={};const c=s();return o.uniqueIdentifier={root:c},o.typeCode=[n,this._createTypeCode("R-10047","SRT","Standard Deviation")],o.description={value:"Standard Deviation"},o.calculationResultCollection={CalculationResult:[this._createCalcResult(i,"Standard Deviation",a,t)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(o),c})),t(this,"createMinCalcEntity",((e,t)=>{let n,{unit:i,min:a}=e;({unit:i,typeCodeDcm:n}=this._getAimUnitAndDcmTypeCode(i));var o={};const c=s();return o.uniqueIdentifier={root:c},o.typeCode=[n,this._createTypeCode("R-404FB","SRT","Minimum")],o.description={value:"Minimum"},o.calculationResultCollection={CalculationResult:[this._createCalcResult(i,"Minimum",a,t)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(o),c})),t(this,"createMaxCalcEntity",((e,t)=>{let n,{unit:i,max:a}=e;({unit:i,typeCodeDcm:n}=this._getAimUnitAndDcmTypeCode(i));var o={};const c=s();return o.uniqueIdentifier={root:c},o.typeCode=[n,this._createTypeCode("G-A437","SRT","Maximum")],o.description={value:"Maximum"},o.calculationResultCollection={CalculationResult:[this._createCalcResult(i,"Maximum",a,t)]},this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(o),c})),t(this,"_getAimUnitAndDcmTypeCode",(e=>"hu"===e?{unit:"[hnsf'U]",typeCodeDcm:this._createTypeCode()}:"suv"===e?{unit:"{SUVbw}g/ml",typeCodeDcm:this._createTypeCode(126401,"DCM","SUVbw")}:{unit:e,typeCodeDcm:this._createTypeCode()})),t(this,"createCommonCalcEntites",((e,t,n,i,a)=>{var o=[];return o.push(this.createMeanCalcEntity(e,a)),o.push(this.createStdDevCalcEntity(t,a)),o.push(this.createMinCalcEntity(n,a)),o.push(this.createMaxCalcEntity(i,a)),o})),t(this,"createLongAxisCalcEntities",((e,t,n,i,a)=>{var o=[];return o.push(this.createLongAxisCalcEntity(e)),o.concat(this.createCommonCalcEntites(t,n,i,a,"LongAxis_"))})),t(this,"createShortAxisCalcEntities",((e,t,n,i,a)=>{var o=[];return o.push(this.createShortAxisCalcEntity(e)),o.concat(this.createCommonCalcEntites(t,n,i,a,"ShortAxis_"))})),t(this,"createCalculationEntityCollection",(e=>{var t={};return t.calculationEntityCollection={CalculationEntity:e},t})),t(this,"_createCoordinate",((e,t)=>{var n={};return n.coordinateIndex={value:t},n.x={value:e.x},n.y={value:e.y},n})),t(this,"_createCoordinateArray",(e=>{var t=[];return e.forEach(((e,n)=>{t.push(this._createCoordinate(e,n))})),t})),t(this,"addMarkupEntity",((e,t,n,i,a,o)=>{this.imageAnnotations.ImageAnnotation[0].markupEntityCollection||(this.imageAnnotations.ImageAnnotation[0].markupEntityCollection={MarkupEntity:[]});var c={includeFlag:{value:!0}};c.twoDimensionSpatialCoordinateCollection={TwoDimensionSpatialCoordinate:this._createCoordinateArray(n)};const r=s();return c["xsi:type"]=e,this.imageAnnotations.ImageAnnotation[0].markupEntityCollection.MarkupEntity.push(c),c.uniqueIdentifier={root:r},c.shapeIdentifier={value:t},c.includeFlag={value:!0},c.imageReferenceUid={root:i},c.referencedFrameNumber={value:a},o&&(c.lineStyle={value:o}),c.twoDimensionSpatialCoordinateCollection={TwoDimensionSpatialCoordinate:this._createCoordinateArray(n)},r})),t(this,"_createModality",(()=>{if(this.temp.aimType!==r.studyAnnotation){const a=this.temp.image[0].sopClassUid;if(a&&o[a])var{codeValue:e,codingSchemeDesignator:t,codeMeaning:n,codingSchemeVersion:i}=o[a];else{const a=this.temp.series.modality;if(a&&o[a])var{codeValue:e,codingSchemeDesignator:t,codeMeaning:n,codingSchemeVersion:i}=o[a]}}else{const a=this.temp.study.modality;if(a&&o[a])var{codeValue:e,codingSchemeDesignator:t,codeMeaning:n,codingSchemeVersion:i}=o[a]}var a={};return a.code=e||"",a.codeSystemName=t||"",a["iso:displayName"]={"xmlns:iso":"uri:iso.org:21090",value:n||""},a.codeSystemVersion=i||"",a})),t(this,"_createImageCollection",(()=>{let e={Image:[]};return this.temp.image.forEach((t=>{let{sopClassUid:n,sopInstanceUid:i}=t;this.temp.aimType===r.imageAnnotation?(n={root:n},i={root:i}):(n={root:""},i={root:""}),e.Image.push({sopClassUid:n,sopInstanceUid:i})})),e})),t(this,"_createImageSeries",(()=>{var e={};return this.temp.aimType===r.studyAnnotation?e.instanceUid={root:""}:e.instanceUid={root:this.temp.series.instanceUid},e.modality=this._createModality(),e.imageCollection=this._createImageCollection(),e})),t(this,"_createImageStudy",(()=>{const{accessionNumber:e,startTime:t,instanceUid:n,startDate:i}=this.temp.study;var a={};return a.instanceUid={root:n},a.startDate={value:i},a.startTime={value:t},a.accessionNumber={value:e},a.imageSeries=this._createImageSeries(),a})),t(this,"_createImageReferenceEntity",(()=>{var e={"xsi:type":"DicomImageReferenceEntity"};return e.uniqueIdentifier={root:s()},e.imageStudy=this._createImageStudy(),e})),t(this,"_createImageReferanceEntityCollection",(()=>{var e={};return e.ImageReferenceEntity=[this._createImageReferenceEntity()],e})),t(this,"_createImageAnnotations",(()=>{const{name:e,comment:t,typeCode:n,imagingPhysicalEntityCollection:i,imagingObservationEntityCollection:a,inferenceEntityCollection:o,trackingUId:c}=this.temp.aim;var l={};return l.uniqueIdentifier={root:s()},l.trackingUniqueIdentifier={root:c},l.typeCode=n,l.dateTime={value:this.getDate()},l.name=e,l.comment=this._getComment(t),l.precedentReferencedAnnotationUid={root:""},i&&(l.imagingPhysicalEntityCollection=i),this.temp.aimType===r.imageAnnotation&&(l.calculationEntityCollection={CalculationEntity:[]},l.imageAnnotationStatementCollection={ImageAnnotationStatement:[]}),a&&(l.imagingObservationEntityCollection=a),o&&(l.inferenceEntityCollection=o),l.imageReferenceEntityCollection=this._createImageReferanceEntityCollection(),l})),t(this,"_getComment",(e=>(e&&e.value?e.value.length&&(e.value=this._getProgrammedComment().concat("~~",e.value)):e.value=this._getProgrammedComment(),e))),t(this,"_getProgrammedComment",(()=>{const e=" / ";let{modality:t,description:n,instanceNumber:i,number:a}=this.temp.series;this.temp.aimType!==r.imageAnnotation&&(i=""),this.temp.aimType===r.studyAnnotation&&(t="");return t+e+n+e+i+e+a})),t(this,"createImageAnnotationStatement",((e,t,n)=>{var i,a={};i=1===e?"CalculationEntityReferencesMarkupEntityStatement":"CalculationEntityReferencesSegmentationEntityStatement",a["xsi:type"]=i,a.subjectUniqueIdentifier={root:n},a.objectUniqueIdentifier={root:t},this.imageAnnotations.ImageAnnotation[0].imageAnnotationStatementCollection.ImageAnnotationStatement.push(a)})),t(this,"createSegmentationEntity",(e=>{var t={};t.referencedSopInstanceUid={root:e.referencedSopInstanceUid},t.segmentNumber={value:1},t.seriesInstanceUid={root:e.seriesInstanceUid},t.studyInstanceUid={root:e.studyInstanceUid},t["xsi:type"]="DicomSegmentationEntity",t.sopClassUid={root:"1.2.840.10008.5.1.4.1.1.66.4"},t.sopInstanceUid={root:e.sopInstanceUid},t.uniqueIdentifier={root:s()};const n=this.imageAnnotations.ImageAnnotation[0];return n.segmentationEntityCollection||(n.segmentationEntityCollection={},n.segmentationEntityCollection.SegmentationEntity=[]),n.segmentationEntityCollection.SegmentationEntity.push(t),t.uniqueIdentifier})),t(this,"_createPerson",(e=>{const{sex:t,name:n,patientId:i,birthDate:a}=e;return{name:{value:n},id:{value:i},birthDate:{value:a},sex:{value:t}}})),t(this,"_createEquipment",(e=>{const{manufacturerName:t,manufacturerModelName:n,softwareVersion:i}=e;return{manufacturerName:{value:t},manufacturerModelName:{value:n},softwareVersion:{value:i}}})),t(this,"_createUser",(e=>{const{name:t,loginName:n}=e;return{name:{value:t},loginName:{value:n}}})),t(this,"getAim",(()=>{const e=this.temp;delete this.temp;const t=`{"ImageAnnotationCollection": ${JSON.stringify(this)} } `;return this.temp=e,t})),t(this,"getAimJSON",(()=>JSON.parse(this.getAim()))),t(this,"getType",(()=>this.temp.aimType));const{image:g,study:h,answers:y,user:p}=e;g||h||y?(i===r.imageAnnotation&&(l=m(g)),i===r.studyAnnotation&&(l=u(h)),d(y,l)):l=e,this.temp={},({aim:this.temp.aim,study:this.temp.study,series:this.temp.series,image:this.temp.image,segmentation:this.temp.segmentation,equipment:this.temp.equipment,user:this.temp.user,person:this.temp.person}=l),this.temp.aimType=i,this.temp.aim.trackingUId=c,this.aimVersion=n,this.uniqueIdentifier="",this.studyInstanceUid={root:this.temp.aim.studyInstanceUid},this.seriesInstanceUid={root:s()},this.accessionNumber={value:this.temp.study.accessionNumber},this.dateTime={value:this.getDate()},this.user=p,this.equipment=this._createEquipment(this.temp.equipment),this.person=this._createPerson(this.temp.person),this.imageAnnotations={ImageAnnotation:[this._createImageAnnotations()]},this.uniqueIdentifier=void 0===a?{root:s()}:{root:a}}static parse(e){return new c(e)}}const r={imageAnnotation:1,seriesAnnotation:2,studyAnnotation:3};function l(e,t){const n=function(e){return e.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0].imageAnnotationStatementCollection?e.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0].imageAnnotationStatementCollection.ImageAnnotationStatement:[]}(e);let i=[];return n.forEach((n=>{if(n.objectUniqueIdentifier.root===t){const t=n.subjectUniqueIdentifier.root,a=function(e){return e.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity}(e);a.forEach((e=>{e.uniqueIdentifier.root===t&&i.push(function(e){var t={};const n=e.calculationResultCollection.CalculationResult[0];if(e.calculationResultCollection.CalculationResult[0].calculationDataCollection){const n=e.calculationResultCollection.CalculationResult[0].calculationDataCollection.CalculationData[0];t.value=n.value.value}else t.value=n.value.value;return t.type=e.description.value,t.unit=n.unitOfMeasure.value,t}(e))}))}})),i}function m(e){var t={aim:{},study:{},series:{},equipment:{},person:{},image:[]};const{aim:n,study:i,series:a,equipment:o,person:s}=t;return n.studyInstanceUid=e.data?.string("x0020000d")||e.metadata.x0020000d||"",i.startTime=e.data?.string("x00080030")||e.metadata?.x00080030||"",i.instanceUid=e.data?.string("x0020000d")||e.metadata?.x0020000d||"",i.startDate=e.data?.string("x00080020")||e.metadata?.x00080020||"",i.accessionNumber=e.data?.string("x00080050")||e.metadata?.x00080050||"",a.instanceUid=e.data?.string("x0020000e")||e.metadata?.x0020000e||"",a.modality=e.data?.string("x00080060")||e.metadata?.x00080060||"",a.number=e.data?.string("x00200011")||e.metadata?.x00200011||"",a.description=e.data?.string("x0008103e")||e.metadata?.x0008103e||"",a.instanceNumber=e.data?.string("x00200013")||e.metadata?.x00200013||"",t.image.push(function(e){return{sopClassUid:e.data.string("x00080016")||e.metadata?.x00080016||"",sopInstanceUid:e.data.string("x00080018")||e.metadata?.x00080018||""}}(e)),o.manufacturerName=e.data?.string("x00080070")||e.metadata?.x00080070||"",o.manufacturerModelName=e.data?.string("x00081090")||e.metadata?.x00081090||"",o.softwareVersion=e.data?.string("x00181020")||e.metadata?.x00181020||"",s.sex=e.data?.string("x00100040")||e.metadata?.x00100040||"",s.name=e.data?.string("x00100010")||e.metadata?.x00100010||"",s.patientId=e.data?.string("x00100020")||e.metadata?.x00100020||"",s.birthDate=e.data?.string("x00100030")||e.metadata?.x00100030||"",t}function u(e){var t={aim:{},study:{},series:{},equipment:{},person:{},image:[]};const{aim:n,study:i,series:a,equipment:o,person:s,image:c}=t,{studyUID:r,studyTime:l,studyDate:m,studyAccessionNumber:u,sex:d,patientName:h,patientID:y,birthdate:p,examTypes:C}=e;return n.studyInstanceUid=r||"",i.startTime=l||"",i.instanceUid=r||"",i.startDate=m||"",i.accessionNumber=u||"",i.modality=g(C)||"",a.instanceUid="",a.modality="",a.number="",a.description="",a.instanceNumber="",c.push({sopClassUid:"",sopInstanceUid:""}),o.manufacturerName="",o.manufacturerModelName="",o.softwareVersion="",s.sex=d||"",s.name=h||"",s.patientId=y||"",s.birthDate=p||"",t}function d(e,t){const{name:n,comment:i,imagingPhysicalEntityCollection:a,imagingObservationEntityCollection:o,inferenceEntity:s,typeCode:c}=e;t.aim.name=n,i&&(t.aim.comment=i),a&&(t.aim.imagingPhysicalEntityCollection=a),o&&(t.aim.imagingObservationEntityCollection=o),s&&(t.aim.inferenceEntity=s),c&&(t.aim.typeCode=c)}const g=e=>{console.log("Exam types",e);var t=e.indexOf("SEG");return t>-1&&e.splice(t,1),e.length?1===e.length?(console.log("Returning ",e[0]),e[0]):e.includes("CT")?e.includes("PT")?"PET-CT":"CT":e.includes("MR")?e.includes("PT")?"PET-MR":"MR":e.includes("US")&&e.includes("RF")?"US-RF":(console.log("Returning default value"),{code:"99EPADM0",codeSystemName:"99EPAD","iso:displayName":{"xmlns:iso":"uri:iso.org:21090",value:"NA"}}):(console.log("Returning empty"),"")};function h(e){let t="";const n=Array.isArray(e.PerFrameFunctionalGroupsSequence)?e.PerFrameFunctionalGroupsSequence[0]:e.PerFrameFunctionalGroupsSequence;if(n.DerivationImageSequence){const e=Array.isArray(n.DerivationImageSequence)?n.DerivationImageSequence[0]:n.DerivationImageSequence;t=Array.isArray(e.SourceImageSequence)?e.SourceImageSequence[0]:e.SourceImageSequence}else if(e.ReferencedSeriesSequence){const n=Array.isArray(e.ReferencedSeriesSequence)?e.ReferencedSeriesSequence[0]:e.ReferencedSeriesSequence;t=Array.isArray(n.ReferencedInstanceSequence)?n.ReferencedInstanceSequence[0]:n.ReferencedInstanceSequence}return t}e.Aim=c,e.addSemanticAnswersToAimData=d,e.addUserToAimData=function({name:e,loginName:t},n){n.user={name:e,loginName:t}},e.createOfflineAimSegmentation=function(e,t){const n=function(e){var t={aim:{},study:{},series:{},equipment:{},person:{},image:[]};const{aim:n,study:i,series:a,equipment:o,person:s}=t;return n.studyInstanceUid=e.StudyInstanceUID||"",n.comment={value:""},i.startTime=e.StudyTime||"",i.instanceUid=e.StudyInstanceUID||"",i.startDate=e.StudyDate||"",i.accessionNumber=e.AccessionNumber||"",a.instanceUid=e.ReferencedSeriesSequence.SeriesInstanceUID||"",t.image.push(function(e){const t=h(e);return{sopClassUid:t.ReferencedSOPClassUID||"",sopInstanceUid:t.ReferencedSOPInstanceUID||""}}(e)),o.manufacturerName=e.Manufacturer||"",o.manufacturerModelName=e.ManufacturerModelName||"",o.softwareVersion=e.SoftwareVersions||"",s.sex=e.PatientSex||"",s.name=e.PatientName||"",s.patientId=e.PatientID||"",s.birthDate=e.PatientBirthDate||"",t}(e);!function(e,t){if(t)e.user=t;else{let t={};t.loginName=sessionStorage.getItem("username"),t.name=sessionStorage.getItem("displayName"),e.user=t}}(n,t);const i=new c(n,r.imageAnnotation);return function(e,t,n){const i=e.createSegmentationEntity(t),{volume:a,min:o,max:s,mean:c,stdDev:r}=n;if(c){const t=e.createMeanCalcEntity({mean:c,unit:"[hnsf'U]"});e.createImageAnnotationStatement(2,i,t)}if(r){const t=e.createStdDevCalcEntity({stdDev:r,unit:"[hnsf'U]"});e.createImageAnnotationStatement(2,i,t)}if(o){const t=e.createMinCalcEntity({min:o,unit:"[hnsf'U]"});e.createImageAnnotationStatement(2,i,t)}if(s){const t=e.createMaxCalcEntity({max:s,unit:"[hnsf'U]"});e.createImageAnnotationStatement(2,i,t)}if(a){const t=e.createMaxCalcEntity({volume:a,unit:"mm3"});e.createImageAnnotationStatement(2,i,t)}}(i,function(e){const t=h(e);let n={};return n.referencedSopInstanceUid=t.ReferencedSOPInstanceUID,n.seriesInstanceUid=e.SeriesInstanceUID,n.studyInstanceUid=e.StudyInstanceUID,n.sopClassUid=e.SOPClassUID,n.sopInstanceUid=e.SOPInstanceUID,n}(e),{}),delete i.imageAnnotations.ImageAnnotation[0].calculationEntityCollection,delete i.imageAnnotations.ImageAnnotation[0].markupEntityCollection,delete i.imageAnnotations.ImageAnnotation[0].imageAnnotationStatementCollection,"Array"!==e.SegmentSequence.constructor.name&&(e.SegmentSequence=[e.SegmentSequence]),i.imageAnnotations.ImageAnnotation[0].name={value:e.SeriesDescription||e.SegmentSequence[0].SegmentLabel},i.imageAnnotations.ImageAnnotation[0].comment={value:""},i.imageAnnotations.ImageAnnotation[0].typeCode=[{code:"SEG",codeSystemName:"99EPAD","iso:displayName":{"xmlns:iso":"uri:iso.org:21090",value:"SEG Only"}}],{aim:i}},e.enumAimType=r,e.getAimImageData=m,e.getImageIdAnnotations=function(e){let t={};try{e.forEach((e=>function(e,t){var n=e.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0];if(!(n.markupEntityCollection&&0!==n.markupEntityCollection.MarkupEntity.length||n.segmentationEntityCollection&&0!==n.segmentationEntityCollection.SegmentationEntity.length)){const i=n.imageReferenceEntityCollection.ImageReferenceEntity[0].imageStudy.imageSeries;t[i.imageCollection.Image[0].sopInstanceUid.root]=[{aimUid:e.ImageAnnotationCollection.uniqueIdentifier.root}]}if(n.markupEntityCollection){n.markupEntityCollection.MarkupEntity.forEach((n=>{const{imageId:i,data:a}=function(e,t){let n={};n.markupType=e["xsi:type"];let i=e.imageReferenceUid.root;const a=e.referencedFrameNumber?e.referencedFrameNumber.value:1;i=i+"&frame="+a;const o=e.uniqueIdentifier.root;n.markupUid=o;let s=[];try{s=l(t,o)}catch(e){console.error("Can not get calculations",e)}s.length&&(n.calculations=s);n.coordinates=e.twoDimensionSpatialCoordinateCollection.TwoDimensionSpatialCoordinate;const c=t.ImageAnnotationCollection.uniqueIdentifier.root;n.aimUid=c;const r=e?.lineColor?.value;n.color=r,e.lineStyle&&(n.lineStyle=e.lineStyle);let m={imageId:i,data:n};r&&(m.data.color=r);return m}(n,e);t[i]?t[i].push(a):t[i]=[a]}))}if(n.segmentationEntityCollection){n.segmentationEntityCollection.SegmentationEntity.forEach((n=>{const{imageId:i,data:a}=function(e,t){const n=e.referencedSopInstanceUid.root,i=e.uniqueIdentifier.root;let a=[];try{a=l(t,i)}catch(e){console.error("Can not get calculations",e)}const o=t.ImageAnnotationCollection.uniqueIdentifier.root;return{imageId:n,data:{markupType:e["xsi:type"],calculations:a,markupUid:i,aimUid:o}}}(n,e);t[i]?t[i].push(a):t[i]=[a]}))}}(e,t)))}catch(e){console.error("Preparing ImageIdAnnotations",e)}return t},e.getStudyAimData=u,e.getStudyModalityFromExamTypes=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=aimapi.min.js.map
