{"version":3,"file":"aimapi.js","sources":["../src/aimConf.js","../utils/modality.js","../utils/aid.js","../src/Aim.jsx","../src/aimHelper.js"],"sourcesContent":["export default {\n  aimVersion: \"AIMv4_2\",\n  \"xmlns:xsi\": \"http://www.w3.org/2001/XMLSchema-instance\",\n  \"xmlns:rdf\": \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\",\n  xmlns: \"gme://caCORE.caCORE/4.4/edu.northwestern.radiology.AIM\",\n  \"xsi:schemaLocation\":\n    \"gme://caCORE.caCORE/4.4/edu.northwestern.radiology.AIM AIM_v4.2_rv2_XML.xsd\"\n};\n","var dcmDesignator = \"DCM\";\nvar lexVersion = \"20121129\";\n//from the link below\n//http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html\n//http://www.dicomlibrary.com/dicom/sop/\n\n//Default Values=> codeValue:99EPADM0 codeMaeaning:NA codingSchemeDesignator:99EPAD\n\nexport var modalities = {\n  \"1.2.840.10008.5.1.4.1.1.2\": {\n    codeValue: \"CT\",\n    codeMeaning: \"Computed Tomography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.1\": {\n    codeValue: \"CR\",\n    codeMeaning: \"Computed Radiography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.128\": {\n    codeValue: \"PT\",\n    codeMeaning: \"Positron emission tomography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.4\": {\n    codeValue: \"MR\",\n    codeMeaning: \"Magnetic Resonance\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.6.1\": {\n    codeValue: \"US\",\n    codeMeaning: \"Ultrasound\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.1.2\": {\n    codeValue: \"MG\",\n    codeMeaning: \"Mammography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  \"1.2.840.10008.5.1.4.1.1.1.2.1\": {\n    codeValue: \"MG\",\n    codeMeaning: \"Mammography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  CT: {\n    codeValue: \"CT\",\n    codeMeaning: \"Computed Tomography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  CR: {\n    codeValue: \"CR\",\n    codeMeaning: \"Computed Radiography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  PT: {\n    codeValue: \"PT\",\n    codeMeaning: \"Positron emission tomography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  MR: {\n    codeValue: \"MR\",\n    codeMeaning: \"Magnetic Resonance\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  US: {\n    codeValue: \"US\",\n    codeMeaning: \"Ultrasound\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  },\n  MG: {\n    codeValue: \"MG\",\n    codeMeaning: \"Mammography\",\n    codingSchemeDesignator: dcmDesignator,\n    codingSchemeVersion: lexVersion\n  }\n};\n","/**\n * For creating DICOM uids\n * Taken from dcmjs MetaDictionary\n * https://github.com/dcmjs-org/dcmjs/blob/master/src/DicomMetaDictionary.js#L5\n */\nexport function generateUid() {\n  let uid = \"2.25.\" + Math.floor(1 + Math.random() * 9);\n  for (let index = 0; index < 38; index++) {\n    uid = uid + Math.floor(Math.random() * 10);\n  }\n  return uid;\n}\n\nexport function persistExpandView(expanded, data, newData, id) {\n  const expandMap = {};\n  let counter = 0;\n  newData.forEach((el, i) => {\n    if (counter < data.length) {\n      if (el[id] === data[counter][id]) {\n        expandMap[i] = expanded[counter];\n        counter += 1;\n      } else {\n        expandMap[i] = false;\n      }\n    }\n  });\n  return expandMap;\n}\n","import aimConf from \"./aimConf\";\nimport { modalities } from \"../utils/modality\";\nimport { generateUid } from \"../utils/aid\";\n\nclass Aim {\n  constructor(imageData, aimType, updatedAimId) {\n    this.temp = {};\n    ({\n      aim: this.temp.aim,\n      study: this.temp.study,\n      series: this.temp.series,\n      image: this.temp.image,\n      segmentation: this.temp.segmentation,\n      equipment: this.temp.equipment,\n      user: this.temp.user,\n      person: this.temp.person\n    } = imageData);\n    this.xmlns = aimConf.xmlns;\n    this[\"xmlns:rdf\"] = aimConf[\"xmlns:rdf\"];\n    this[\"xmlns:xsi\"] = aimConf[\"xmlns:xsi\"];\n    this.aimVersion = aimConf.aimVersion;\n    this[\"xsi:schemaLocation\"] = aimConf[\"xsi:schemaLocation\"];\n    this.uniqueIdentifier = \"\";\n    this.studyInstanceUid = { root: this.temp.aim.studyInstanceUid };\n    this.seriesInstanceUid = { root: generateUid() };\n    this.accessionNumber = { value: this.temp.study.accessionNumber };\n    this.dateTime = { value: this.getDate() };\n    this.user = this._createUser(this.temp.user);\n    this.equipment = this._createEquipment(this.temp.equipment);\n    this.person = this._createPerson(this.temp.person);\n    this.imageAnnotations = {\n      ImageAnnotation: [this._createImageAnnotations(aimType)]\n    };\n    if (updatedAimId === undefined)\n      this.uniqueIdentifier = { root: generateUid() };\n    else this.uniqueIdentifier = { root: updatedAimId };\n  }\n\n  static parse(data) {\n    return new Aim(data);\n  }\n\n  // static getMarkups(aim) {\n  //   let annotations = [];\n  //   let annotation = {};\n  //   const markupEntities =\n  //     aim.imageAnnotations.ImageAnnotation.markupEntityCollection.MarkupEntity;\n\n  //   if (markupEntities.constructor === Array) {\n  //     markupEntities.map(markupEntity => {\n  //       var imageId = markupEntity[\"imageReferenceUid\"][\"root\"];\n  //       var markupUid = markupEntity[\"uniqueIdentifier\"][\"root\"];\n  //       var calculations = this.getCalculationEntitiesOfMarkUp(aim, markupUid);\n  //       annotations.push({\n  //         imageId: imageId,\n  //         markupType: markupEntity[\"xsi:type\"],\n  //         coordinates:\n  //           markupEntity.twoDimensionSpatialCoordinateCollection\n  //             .TwoDimensionSpatialCoordinate,\n  //         calculations: calculations\n  //       });\n  //       this.getCalculationEntitiesOfMarkUp(aim);\n  //     });\n  //     return annotations;\n  //   } else if (\n  //     Object.entries(markupEntities).length !== 0 &&\n  //     markupEntities.constructor === Object\n  //   ) {\n  //     const imageId = markupEntities[\"imageReferenceUid\"][\"root\"];\n  //     const markupUid = markupEntities[\"uniqueIdentifier\"][\"root\"];\n  //     const calculations = this.getCalculationEntitiesOfMarkUp(aim, markupUid);\n  //     return {\n  //       imageId: imageId,\n  //       markupType: markupEntities[\"xsi:type\"],\n  //       coordinates:\n  //         markupEntities.twoDimensionSpatialCoordinateCollection\n  //           .TwoDimensionSpatialCoordinate,\n  //       calculations: calculations\n  //     };\n  //   }\n  // }\n\n  getDate = () => {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = (\"0\" + (now.getMonth() + 1)).slice(-2);\n    const day = (\"0\" + now.getDate()).slice(-2);\n    const hours = (\"0\" + now.getHours()).slice(-2);\n    const minutes = (\"0\" + now.getMinutes()).slice(-2);\n    const seconds = (\"0\" + now.getSeconds()).slice(-2);\n    return year + month + day + hours + minutes + seconds;\n  };\n\n  _createObject = (name, value) => {\n    var obj = {};\n    obj[name] = { value };\n    return obj;\n  };\n\n  /*                                          */\n  /*  Calculation Entitiy Realted Functions   */\n  /*                                          */\n\n  _createDimension = (label, index = 0, size = 1) => {\n    return {\n      Dimension: [\n        Object.assign(\n          {},\n          this._createObject(\"size\", size),\n          this._createObject(\"index\", index),\n          this._createObject(\"label\", label)\n        )\n      ]\n    };\n  };\n\n  _createDoubleDataType = () => {\n    var obj = {\n      dataType: {\n        code: \"C48870\",\n        codeSystem: \"NCI\",\n        \"iso:displayName\": { \"xmlns:iso\": \"uri:iso.org:21090\", value: \"Double\" }\n      }\n    };\n    return obj;\n  };\n\n  //preLabel is used for preceding the name like LongAxis || ShortAxis\n  _createCalcResult = (unit, label, value, preLabel = \"\") => {\n    var obj = this._createObject(\"unitOfMeasure\", unit);\n    Object.assign(obj, this._createDoubleDataType());\n    obj[\"xsi:type\"] = \"CompactCalculationResult\";\n    obj[\"dimensionCollection\"] = this._createDimension(preLabel + label);\n    obj[\"type\"] = \"Scalar\";\n    Object.assign(obj, this._createObject(\"value\", `${value}`));\n    return obj;\n  };\n\n  //if called with the default values returns DCM type code\n  _createTypeCode = (\n    code = \"11203\",\n    codeSystemName = \"DCM\",\n    displayNameValue = \"Attenuation Coefficient\"\n  ) => {\n    var obj = {};\n    obj[\"code\"] = code;\n    obj[\"codeSystemName\"] = codeSystemName;\n    obj[\"iso:displayName\"] = {\n      \"xmlns:iso\": \"uri:iso.org:21090\",\n      value: displayNameValue\n    };\n    return obj;\n  };\n\n  createLengthCalcEntity = length => {\n    let { unit, value } = length;\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [this._createCalcResult(unit, \"LineLength\", value)]\n    };\n    obj[\"description\"] = { value: \"Length\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [this._createTypeCode(\"G-D7FE\", \"SRT\", \"Length\")];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createLongAxisCalcEntity = longAxis => {\n    let { unit, value } = longAxis;\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [this._createCalcResult(unit, \"LongAxis\", value)]\n    };\n    obj[\"description\"] = { value: \"LongAxis\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [this._createTypeCode(\"G-A185\", \"SRT\", \"LongAxis\")];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createShortAxisCalcEntity = shortAxis => {\n    let { unit, value } = shortAxis;\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [this._createCalcResult(unit, \"ShortAxis\", value)]\n    };\n    obj[\"description\"] = { value: \"ShortAxis\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [this._createTypeCode(\"G-A186\", \"SRT\", \"ShortAxis\")];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createMeanCalcEntity = (value, preLabel) => {\n    var { unit, mean } = value;\n    console.log(\"Unit\", unit);\n    const { unitObj, typeCodeDcm } = this._getAimUnitAndDcmTypeCode(unit);\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [this._createCalcResult(unitObj, \"Mean\", mean, preLabel)]\n    };\n    obj[\"description\"] = { value: \"Mean\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [\n      typeCodeDcm,\n      this._createTypeCode(\"R-00317\", \"SRT\", \"Mean\")\n    ];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection.CalculationEntity.push(\n      obj\n    );\n    return uId;\n  };\n\n  createStdDevCalcEntity = (value, preLabel) => {\n    var { unit, stdDev } = value;\n    const { unitObj, typeCodeDcm } = this._getAimUnitAndDcmTypeCode(unit);\n\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [\n        this._createCalcResult(unitObj, \"Standard Deviation\", stdDev, preLabel)\n      ]\n    };\n    obj[\"description\"] = { value: \"Standard Deviation\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [\n      typeCodeDcm,\n      this._createTypeCode(\"R-10047\", \"SRT\", \"Standard Deviation\")\n    ];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createMinCalcEntity = (value, preLabel) => {\n    var { unit, min } = value;\n    const { unitObj, typeCodeDcm } = this._getAimUnitAndDcmTypeCode(unit);\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [\n        this._createCalcResult(unitObj, \"Minimum\", min, preLabel)\n      ]\n    };\n    obj[\"description\"] = { value: \"Minimum\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [\n      typeCodeDcm,\n      this._createTypeCode(\"R-404FB\", \"SRT\", \"Minimum\")\n    ];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createMaxCalcEntity = (value, preLabel) => {\n    var { unit, max } = value;\n    const { unitObj, typeCodeDcm } = this._getAimUnitAndDcmTypeCode(unit);\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [\n        this._createCalcResult(unitObj, \"Maximum\", max, preLabel)\n      ]\n    };\n    obj[\"description\"] = { value: \"Maximum\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [\n      typeCodeDcm,\n      this._createTypeCode(\"G-A437\", \"SRT\", \"Maximum\")\n    ];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  _getAimUnitAndDcmTypeCode = unit => {\n    if (unit === \"hu\")\n      return { unit: \"[hnsf'U]\", typeCodeDcm: this._createTypeCode() };\n    else if (unit === \"suv\")\n      return {\n        unit: \"{SUVbw}g/ml\",\n        typeCodeDcm: this._createTypeCode(126401, \"DCM\", \"SUVbw\")\n      };\n  };\n\n  createVolumeCalcEntity = (value, preLabel) => {\n    var { unit, volume } = value;\n    var obj = {};\n    obj[\"calculationResultCollection\"] = {\n      CalculationResult: [\n        this._createCalcResult(unit, \"Volume\", volume, preLabel)\n      ]\n    };\n    obj[\"description\"] = { value: \"Volume\" };\n    const uId = generateUid();\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"typeCode\"] = [this._createTypeCode(\"RID28668\", \"Radlex\", \"Volume\")];\n    this.imageAnnotations.ImageAnnotation[0].calculationEntityCollection[\n      \"CalculationEntity\"\n    ].push(obj);\n    return uId;\n  };\n\n  createCommonCalcEntites = (mean, stdDev, min, max, preLabel) => {\n    var entities = [];\n    entities.push(this.createMeanCalcEntity(mean, preLabel));\n    entities.push(this.createStdDevCalcEntity(stdDev, preLabel));\n    entities.push(this.createMinCalcEntity(min, preLabel));\n    entities.push(this.createMaxCalcEntity(max, preLabel));\n    return entities;\n  };\n\n  // createLineCalcEntities = (length, mean, stdDev, min, max) => {\n  //   var entities = [];\n  //   entities.push(this.createLengthCalcEntity(length));\n  //   return entities.concat(\n  //     this.createCommonCalcEntites(mean, stdDev, min, max)\n  //   );\n  // };\n\n  createLongAxisCalcEntities = (longAxis, mean, stdDev, min, max) => {\n    var entities = [];\n    entities.push(this.createLongAxisCalcEntity(longAxis));\n    return entities.concat(\n      this.createCommonCalcEntites(mean, stdDev, min, max, \"LongAxis_\")\n    );\n  };\n\n  createShortAxisCalcEntities = (shortAxis, mean, stdDev, min, max) => {\n    var entities = [];\n    entities.push(this.createShortAxisCalcEntity(shortAxis));\n    return entities.concat(\n      this.createCommonCalcEntites(mean, stdDev, min, max, \"ShortAxis_\")\n    );\n  };\n\n  createCalculationEntityCollection = entities => {\n    var obj = {};\n    obj[\"calculationEntityCollection\"] = { CalculationEntity: entities };\n    return obj;\n  };\n\n  /*                                          */\n  /*  Markup Entitiy Realted Functions        */\n  /*                                          */\n\n  _createCoordinate = (coordinate, index) => {\n    var obj = {};\n    obj[\"x\"] = { value: coordinate.x };\n    obj[\"coordinateIndex\"] = { value: index };\n    obj[\"y\"] = { value: coordinate.y };\n    return obj;\n  };\n\n  _createCoordinateArray = points => {\n    var coordinates = [];\n    points.forEach((point, index) => {\n      coordinates.push(this._createCoordinate(point, index));\n    });\n    return coordinates;\n  };\n\n  addMarkupEntity = (type, shapeIndex, points, imageReferenceUid) => {\n    const frameNumber = this._getFrameNumber(imageReferenceUid);\n    if (frameNumber > -1)\n      imageReferenceUid = imageReferenceUid.split(\"&frame=\")[0]; //if multiframe strip the frame number from imageUID\n\n    var obj = {};\n    obj[\"includeFlag\"] = { value: true };\n    obj[\"twoDimensionSpatialCoordinateCollection\"] = {\n      TwoDimensionSpatialCoordinate: this._createCoordinateArray(points)\n    };\n    const uId = generateUid();\n    obj[\"shapeIdentifier\"] = { value: shapeIndex };\n    obj[\"uniqueIdentifier\"] = { root: uId };\n    obj[\"xsi:type\"] = type;\n    obj[\"imageReferenceUid\"] = { root: imageReferenceUid };\n    obj[\"referencedFrameNumber\"] = { value: frameNumber };\n    this.imageAnnotations.ImageAnnotation[0].markupEntityCollection.MarkupEntity.push(\n      obj\n    );\n    return uId;\n  };\n\n  _getFrameNumber = imageReferenceUid => {\n    const frameNumber = imageReferenceUid.split(\"frame=\");\n    if (frameNumber.length > 1) return frameNumber[1];\n    return 1;\n  };\n\n  /*                                          */\n  /*  Image Refrence Entity Collection        */\n  /*                                          */\n  _createModality = () => {\n    const sopClassUid = this.temp.image[0].sopClassUid;\n    if (sopClassUid && modalities[sopClassUid])\n      var {\n        codeValue,\n        codingSchemeDesignator,\n        codeMeaning,\n        codingSchemeVersion\n      } = modalities[sopClassUid];\n    else {\n      const modality = this.temp.series.modality;\n      if (modality && modalities[modality]) {\n        var {\n          codeValue,\n          codingSchemeDesignator,\n          codeMeaning,\n          codingSchemeVersion\n        } = modalities[modality];\n      }\n    }\n    var obj = {};\n    obj[\"code\"] = codeValue || \"\";\n    obj[\"codeSystemName\"] = codingSchemeDesignator || \"\";\n    obj[\"iso:displayName\"] = {\n      \"xmlns:iso\": \"uri:iso.org:21090\",\n      value: codeMeaning || \"\"\n    };\n    obj[\"codeSystemVersion\"] = codingSchemeVersion || \"\";\n    return obj;\n  };\n\n  _createImageCollection = () => {\n    let obj = {};\n    obj[\"Image\"] = [];\n    this.temp.image.forEach(image => {\n      let { sopClassUid, sopInstanceUid } = image;\n      sopClassUid = { root: sopClassUid };\n      sopInstanceUid = { root: sopInstanceUid };\n      obj[\"Image\"].push({ sopClassUid, sopInstanceUid });\n    });\n    return obj;\n  };\n\n  _createImageSeries = () => {\n    var obj = {};\n    obj[\"modality\"] = this._createModality();\n    obj[\"imageCollection\"] = this._createImageCollection();\n    obj[\"instanceUid\"] = { root: this.temp.series.instanceUid };\n    return obj;\n  };\n\n  _createImageStudy = () => {\n    const {\n      accessionNumber,\n      startTime,\n      instanceUid,\n      startDate\n    } = this.temp.study;\n    var obj = {};\n    obj[\"imageSeries\"] = this._createImageSeries();\n    obj[\"startTime\"] = { value: startTime };\n    obj[\"instanceUid\"] = { root: instanceUid };\n    obj[\"startDate\"] = { value: startDate };\n    obj[\"accessionNumber\"] = { value: accessionNumber };\n    return obj;\n  };\n\n  _createImageReferenceEntity = () => {\n    var obj = {};\n    obj[\"imageStudy\"] = this._createImageStudy();\n    obj[\"xsi:type\"] = \"DicomImageReferenceEntity\";\n    obj[\"uniqueIdentifier\"] = { root: generateUid() };\n    return obj;\n  };\n\n  _createImageReferanceEntityCollection = () => {\n    var obj = {};\n    obj[\"ImageReferenceEntity\"] = [this._createImageReferenceEntity()];\n    return obj;\n  };\n\n  //\n  //\n  //\n  _createImageAnnotations = aimType => {\n    const {\n      name,\n      comment,\n      typeCode,\n      imagingPhysicalEntityCollection,\n      imagingObservationEntityCollection,\n      inferenceEntityCollection\n    } = this.temp.aim;\n    var obj = {};\n    obj[\"uniqueIdentifier\"] = { root: generateUid() };\n    obj[\"typeCode\"] = typeCode;\n    obj[\"dateTime\"] = { value: this.getDate() };\n    obj[\"name\"] = name;\n    obj[\"comment\"] = comment;\n    obj[\"precedentReferencedAnnotationUid\"] = { root: \"\" };\n    if (imagingPhysicalEntityCollection)\n      obj[\"imagingPhysicalEntityCollection\"] = imagingPhysicalEntityCollection;\n    if (aimType === 1) {\n      //if this is an image annotation\n      obj[\"calculationEntityCollection\"] = { CalculationEntity: [] };\n      obj[\"markupEntityCollection\"] = { MarkupEntity: [] };\n      obj[\"imageAnnotationStatementCollection\"] = {\n        ImageAnnotationStatement: []\n      };\n    }\n    if (imagingObservationEntityCollection)\n      obj[\n        \"imagingObservationEntityCollection\"\n      ] = imagingObservationEntityCollection;\n    if (inferenceEntityCollection)\n      obj[\"inferenceEntityCollection\"] = inferenceEntityCollection;\n    obj[\n      \"imageReferenceEntityCollection\"\n    ] = this._createImageReferanceEntityCollection();\n    return obj;\n  };\n\n  createImageAnnotationStatement = (referenceType, objectId, subjectId) => {\n    //this is called externally\n    var obj = {};\n    var references;\n    referenceType === 1\n      ? (references = \"CalculationEntityReferencesMarkupEntityStatement\")\n      : (references = \"CalculationEntityReferencesSegmentationEntityStatement\");\n    obj[\"xsi:type\"] = references;\n    obj[\"objectUniqueIdentifier\"] = { root: objectId };\n    obj[\"subjectUniqueIdentifier\"] = { root: subjectId };\n    this.imageAnnotations.ImageAnnotation[0].imageAnnotationStatementCollection.ImageAnnotationStatement.push(\n      obj\n    );\n  };\n\n  // createImageAnnotationStatementCollection = () => {\n  //   var obj = {};\n  //   obj[\"ImageAnnotationStatement\"] = [];\n  //   return obj;\n  // };\n\n  // //\n  // //\n  // // Image Annotations\n  // createImageAnnotation = (annotationStatementCollection = {}) => {\n  //   var obj = {};\n  //   obj[\"dateTime\"] = { value: this.getDate() };\n  //   obj[\n  //     \"imageAnnotationStatementCollection\"\n  //   ] = this.createImageAnnotationStatementCollection();\n  //   return obj;\n  // };\n\n  // createImageAnnotations = imageAnnotation => {\n  //   var obj = {};\n  //   obj[\"imageAnnotations\"] = imageAnnotation;\n  //   return obj;\n  // };\n\n  /*                                                */\n  /*    Segmentation Entitiy Realted Functions      */\n  /*                                                */\n\n  createSegmentationEntity = segmentation => {\n    var obj = {};\n    obj[\"referencedSopInstanceUid\"] = {\n      root: segmentation.referencedSopInstanceUid\n    };\n    obj[\"segmentNumber\"] = { value: 1 };\n    obj[\"seriesInstanceUid\"] = {\n      root: segmentation.seriesInstanceUid\n    };\n    obj[\"studyInstanceUid\"] = {\n      root: segmentation.studyInstanceUid\n    };\n    obj[\"xsi:type\"] = \"DicomSegmentationEntity\";\n    obj[\"sopClassUid\"] = { root: \"1.2.840.10008.5.1.4.1.1.66.4\" };\n    obj[\"sopInstanceUid\"] = { root: segmentation.sopInstanceUid };\n    obj[\"uniqueIdentifier\"] = { root: generateUid() };\n    const imageAnnotation = this.imageAnnotations.ImageAnnotation[0];\n    if (!imageAnnotation.segmentationEntityCollection) {\n      imageAnnotation.segmentationEntityCollection = {};\n      imageAnnotation.segmentationEntityCollection.SegmentationEntity = [];\n    }\n    imageAnnotation.segmentationEntityCollection.SegmentationEntity.push(obj);\n    return obj[\"uniqueIdentifier\"];\n  };\n\n  //\n  //\n  // Person\n  _createPerson = person => {\n    const { sex, name, patientId, birthDate } = person;\n    return {\n      sex: { value: sex },\n      name: { value: name },\n      id: { value: patientId },\n      birthDate: { value: birthDate }\n    };\n  };\n\n  //\n  //\n  // Eqipment\n  _createEquipment = equipment => {\n    const {\n      manufacturerName,\n      manufacturerModelName,\n      softwareVersion\n    } = equipment;\n    return {\n      manufacturerName: { value: manufacturerName },\n      manufacturerModelName: { value: manufacturerModelName },\n      softwareVersion: { value: softwareVersion }\n    };\n  };\n\n  //\n  //\n  // User\n  _createUser = user => {\n    const { loginName, name } = user;\n    return {\n      loginName: { value: loginName },\n      name: { value: name }\n    };\n  };\n\n  getAim = () => {\n    delete this[\"temp\"];\n    const stringAim = JSON.stringify(this);\n    const wrappedAim = `{\"ImageAnnotationCollection\": ${stringAim} } `;\n    return wrappedAim;\n  };\n}\n\nexport default Aim;\n","import Aim from \"./Aim.jsx\";\n\n// moved from aimEditor.jsx\nconst enumAimType = {\n  imageAnnotation: 1,\n  seriesAnnotation: 2,\n  studyAnnotation: 3,\n};\n\nexport function getImageIdAnnotations(aims) {\n  let imageIdSpecificMarkups = {};\n  aims.forEach(aim => parseAim(aim, imageIdSpecificMarkups));\n  return imageIdSpecificMarkups;\n}\n\nfunction parseAim(aim, imageIdSpecificMarkups) {\n  var imageAnnotation =\n    aim.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0];\n  //check if the aim has markup\n  if (imageAnnotation.markupEntityCollection) {\n    var markupEntities = imageAnnotation.markupEntityCollection.MarkupEntity;\n    markupEntities.forEach(markupEntity => {\n      const { imageId, data } = getMarkup(markupEntity, aim);\n      if (!imageIdSpecificMarkups[imageId])\n        imageIdSpecificMarkups[imageId] = [data];\n      else imageIdSpecificMarkups[imageId].push(data);\n    });\n  }\n  //check if it has segmentation\n  if (imageAnnotation.segmentationEntityCollection) {\n    var segmentationEntities =\n      imageAnnotation.segmentationEntityCollection.SegmentationEntity;\n    segmentationEntities.forEach(segmentationEntity => {\n      const { imageId, data } = getSegmentation(segmentationEntity, aim);\n      if (!imageIdSpecificMarkups[imageId])\n        imageIdSpecificMarkups[imageId] = [data];\n      else imageIdSpecificMarkups[imageId].push(data);\n    });\n  }\n}\n\nfunction getMarkup(markupEntity, aim) {\n  let imageId = markupEntity[\"imageReferenceUid\"][\"root\"];\n  const frameNumber = markupEntity[\"referencedFrameNumber\"][\"value\"];\n  // if (frameNumber > -1) imageId = imageId + \"&frame=\" + frameNumber; //if multiframe reconstruct the imageId\n  imageId = imageId + \"&frame=\" + frameNumber;\n  const markupUid = markupEntity[\"uniqueIdentifier\"][\"root\"];\n  let calculations = [];\n  try {\n    calculations = getCalculationEntitiesOfMarkUp(aim, markupUid);\n  } catch (error) {\n    console.log(\"Can not get calculations\", error);\n  }\n  const aimUid = aim.ImageAnnotationCollection[\"uniqueIdentifier\"][\"root\"];\n  return {\n    imageId,\n    data: {\n      markupType: markupEntity[\"xsi:type\"],\n      calculations,\n      coordinates:\n        markupEntity.twoDimensionSpatialCoordinateCollection\n          .TwoDimensionSpatialCoordinate,\n      markupUid,\n      aimUid\n    }\n  };\n}\n\nfunction getSegmentation(segmentationEntity, aim) {\n  const imageId = segmentationEntity[\"referencedSopInstanceUid\"][\"root\"];\n  const markupUid = segmentationEntity[\"uniqueIdentifier\"][\"root\"];\n  const calculations = getCalculationEntitiesOfMarkUp(aim, markupUid);\n  const aimUid = aim.ImageAnnotationCollection[\"uniqueIdentifier\"][\"root\"];\n  return {\n    imageId,\n    data: {\n      markupType: segmentationEntity[\"xsi:type\"],\n      calculations,\n      markupUid,\n      aimUid\n    }\n  };\n}\n\nfunction getCalculationEntitiesOfMarkUp(aim, markupUid) {\n  const imageAnnotationStatements = getImageAnnotationStatements(aim);\n  let calculations = [];\n  imageAnnotationStatements.forEach(statement => {\n    if (statement.objectUniqueIdentifier.root === markupUid) {\n      const calculationUid = statement.subjectUniqueIdentifier.root;\n      const calculationEntities = getCalculationEntities(aim);\n      calculationEntities.forEach(calculation => {\n        if (calculation.uniqueIdentifier.root === calculationUid)\n          calculations.push(parseCalculation(calculation));\n      });\n    }\n  });\n  return calculations;\n}\n\nfunction getImageAnnotationStatements(aim) {\n  return aim.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0]\n    .imageAnnotationStatementCollection.ImageAnnotationStatement;\n}\n\nfunction getCalculationEntities(aim) {\n  return aim.ImageAnnotationCollection.imageAnnotations.ImageAnnotation[0]\n    .calculationEntityCollection.CalculationEntity;\n}\n\nfunction parseCalculation(calculation) {\n  var obj = {};\n  const calcResult =\n    calculation.calculationResultCollection.CalculationResult[0];\n  if (\n    calculation.calculationResultCollection.CalculationResult[0]\n      .calculationDataCollection\n  ) {\n    const calcValue =\n      calculation.calculationResultCollection.CalculationResult[0]\n        .calculationDataCollection.CalculationData[0];\n    obj[\"value\"] = calcValue[\"value\"][\"value\"];\n  } else obj[\"value\"] = calcResult[\"value\"][\"value\"];\n  obj[\"type\"] = calculation[\"description\"][\"value\"];\n  obj[\"unit\"] = calcResult[\"unitOfMeasure\"][\"value\"];\n  return obj;\n}\n\nexport function getAimImageData(image) {\n  var obj = {};\n  obj.aim = {};\n  obj.study = {};\n  obj.series = {};\n  obj.equipment = {};\n  obj.person = {};\n  obj.image = [];\n  const { aim, study, series, equipment, person } = obj;\n\n  aim.studyInstanceUid = image.data.string(\"x0020000d\") || \"\";\n\n  study.startTime = image.data.string(\"x00080030\") || \"\";\n  study.instanceUid = image.data.string(\"x0020000d\") || \"\";\n  study.startDate = image.data.string(\"x00080020\") || \"\";\n  study.accessionNumber = image.data.string(\"x00080050\") || \"\";\n\n  series.instanceUid = image.data.string(\"x0020000e\") || \"\";\n  series.modality = image.data.string(\"x00080060\") || \"\";\n\n  obj.image.push(getSingleImageData(image));\n\n  equipment.manufacturerName = image.data.string(\"x00080070\") || \"\";\n  equipment.manufacturerModelName = image.data.string(\"x00081090\") || \"\";\n  equipment.softwareVersion = image.data.string(\"x00181020\") || \"\";\n\n  person.sex = image.data.string(\"x00100040\") || \"\";\n  person.name = image.data.string(\"x00100010\") || \"\";\n  person.patientId = image.data.string(\"x00100020\") || \"\";\n  person.birthDate = image.data.string(\"x00100030\") || \"\";\n\n  return obj;\n}\n\nfunction getSingleImageData(image) {\n  return {\n    sopClassUid: image.data.string(\"x00080016\") || \"\",\n    sopInstanceUid: image.data.string(\"x00080018\") || \"\"\n  };\n}\n\nfunction addSingleImageDataToAim(aim, image) {\n  if (!aim.image) return;\n  aim.image.push(getSingleImageData(image));\n}\n\n// ---------- aimapi additional methods --------\n// new method inspired by createAimSegmentation in aimEditor.jsx\nexport function createOfflineAimSegmentation(segmentation, userInfo) {\n  // prapare the seed data and create aim\n  const seedData = getAimImageDataFromSeg(segmentation); //aimhelper\n  // admin/ upload user\n  addUserToSeedData(seedData, userInfo);\n  const aim = new Aim(seedData, enumAimType.imageAnnotation); // no this.updatedAimId.\n  // let dataset = await getDatasetFromBlob(segmentation);\n  // if update segmentation Uid should be same as the previous one\n  // console.log('Dataset series uid', segmentation);\n  // fill the segmentation related aim parts\n  const segEntityData = getSegmentationEntityDataFromSeg(segmentation);\n  // TODO fill in stats\n  const segStats = {};\n  addSegmentationToAim(aim, segEntityData, segStats);\n  console.log('AIM in segmentation', aim);\n  return { aim };\n}\n// moved from aimEditor.jsx\nfunction addUserToSeedData(seedData, userInfo) {\n  // this is ui specific, should be changed\n  if (userInfo) {\n    seedData.user = userInfo;\n  } else {\n    let obj = {};\n    obj.loginName = sessionStorage.getItem('username');\n    obj.name = sessionStorage.getItem('displayName');\n    seedData.user = obj;\n  }\n}\n// moved from aimEditor.jsx\nfunction getDatasetFromBlob(segBlob, imageIdx) {\n  return new Promise(resolve => {\n    let segArrayBuffer;\n    var fileReader = new FileReader();\n    fileReader.onload = event => {\n      segArrayBuffer = event.target.result;\n      const dicomData = dcmjs.data.DicomMessage.readFile(segArrayBuffer);\n      const dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(dicomData.dict);\n      dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(dicomData.meta);\n      resolve(dataset);\n    };\n    fileReader.readAsArrayBuffer(segBlob);\n  });\n}\n// moved from aimEditor.jsx\nfunction addSegmentationToAim(aim, segEntityData, segStats) {\n  const segId = aim.createSegmentationEntity(segEntityData);\n  const { volume, min, max, mean, stdDev } = segStats;\n  if (mean) {\n    const meanId = aim.createMeanCalcEntity({ mean, unit: \"[hnsf'U]\" });\n    aim.createImageAnnotationStatement(2, segId, meanId);\n  }\n  if (stdDev) {\n    const stdDevId = aim.createStdDevCalcEntity({ stdDev, unit: \"[hnsf'U]\" });\n    aim.createImageAnnotationStatement(2, segId, stdDevId);\n  }\n  if (min) {\n    const minId = aim.createMinCalcEntity({ min, unit: \"[hnsf'U]\" });\n    aim.createImageAnnotationStatement(2, segId, minId);\n  }\n  if (max) {\n    const maxId = aim.createMaxCalcEntity({ max, unit: \"[hnsf'U]\" });\n    aim.createImageAnnotationStatement(2, segId, maxId);\n  }\n  if (volume) {\n    const volumeId = aim.createMaxCalcEntity({ volume, unit: 'mm3' });\n    aim.createImageAnnotationStatement(2, segId, volumeId);\n  }\n}\n// new method inspired by moved getSegmentationEntityData from aimEditor.jsx\nfunction getSegmentationEntityDataFromSeg(dataset) {\n  const refImage = getRefImageFromSeg(dataset);\n  let obj = {};\n  obj['referencedSopInstanceUid'] = refImage.ReferencedSOPInstanceUID;\n  obj['seriesInstanceUid'] = dataset.SeriesInstanceUID;\n  obj['studyInstanceUid'] = dataset.StudyInstanceUID;\n  obj['sopClassUid'] = dataset.SOPClassUID;\n  obj['sopInstanceUid'] = dataset.SOPInstanceUID;\n  return obj;\n}\n// new method to populate image data from segmentation dicom image\nfunction getAimImageDataFromSeg(image) {\n  var obj = {};\n  obj.aim = {};\n  obj.study = {};\n  obj.series = {};\n  obj.equipment = {};\n  obj.person = {};\n  obj.image = [];\n  const { aim, study, series, equipment, person } = obj;\n  // seg data is coming in dcmjs format\n  aim.studyInstanceUid = image.StudyInstanceUID || '';\n  study.startTime = image.StudyTime || '';\n  study.instanceUid = image.StudyInstanceUID || '';\n  study.startDate = image.StudyDate || '';\n  study.accessionNumber = image.AccessionNumber || '';\n  series.instanceUid = image.ReferencedSeriesSequence.SeriesInstanceUID || '';\n  obj.image.push(getSingleImageDataFromSeg(image));\n  equipment.manufacturerName = image.Manufacturer || '';\n  equipment.manufacturerModelName = image.ManufacturerModelName || '';\n  equipment.softwareVersion = image.SoftwareVersions || '';\n  person.sex = image.PatientSex || '';\n  person.name = image.PatientName || '';\n  person.patientId = image.PatientID || '';\n  person.birthDate = image.PatientBirthDate || '';\n  return obj;\n}\nfunction getRefImageFromSeg(dataset) {\n  // I needed to check if the sequence is array in each step as dcmjs makes it an object if there is only one item\n  const firstFrame = Array.isArray(dataset.PerFrameFunctionalGroupsSequence)? dataset.PerFrameFunctionalGroupsSequence[0] : dataset.PerFrameFunctionalGroupsSequence;\n  const derivation = Array.isArray(firstFrame.DerivationImageSequence)? firstFrame.DerivationImageSequence[0] : firstFrame.DerivationImageSequence;\n  const refImage = Array.isArray(derivation.SourceImageSequence)? derivation.SourceImageSequence[0] : derivation.SourceImageSequence;\n  return refImage;\n}\n\n// new method inspired by getSingleImageData to get data from segmentations\nfunction getSingleImageDataFromSeg(image) {\n  const refImage = getRefImageFromSeg(image);\n  return {\n    sopClassUid: refImage.ReferencedSOPClassUID || '',\n    sopInstanceUid: refImage.ReferencedSOPInstanceUID || '',\n  };\n}"],"names":["aimVersion","xmlns","dcmDesignator","lexVersion","modalities","codeValue","codeMeaning","codingSchemeDesignator","codingSchemeVersion","CT","CR","PT","MR","US","MG","generateUid","uid","Math","floor","random","index","Aim","constructor","imageData","aimType","updatedAimId","now","Date","year","getFullYear","month","getMonth","slice","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","name","value","obj","label","size","Dimension","Object","assign","_createObject","dataType","code","codeSystem","unit","preLabel","_createDoubleDataType","_createDimension","codeSystemName","displayNameValue","length","CalculationResult","_createCalcResult","uId","root","_createTypeCode","imageAnnotations","ImageAnnotation","calculationEntityCollection","push","longAxis","shortAxis","mean","console","log","unitObj","typeCodeDcm","_getAimUnitAndDcmTypeCode","CalculationEntity","stdDev","min","max","volume","entities","createMeanCalcEntity","createStdDevCalcEntity","createMinCalcEntity","createMaxCalcEntity","createLongAxisCalcEntity","concat","createCommonCalcEntites","createShortAxisCalcEntity","coordinate","x","y","points","coordinates","forEach","point","_createCoordinate","type","shapeIndex","imageReferenceUid","frameNumber","_getFrameNumber","split","TwoDimensionSpatialCoordinate","_createCoordinateArray","markupEntityCollection","MarkupEntity","sopClassUid","temp","image","modality","series","sopInstanceUid","_createModality","_createImageCollection","instanceUid","accessionNumber","startTime","startDate","study","_createImageSeries","_createImageStudy","_createImageReferenceEntity","comment","typeCode","imagingPhysicalEntityCollection","imagingObservationEntityCollection","inferenceEntityCollection","aim","ImageAnnotationStatement","_createImageReferanceEntityCollection","referenceType","objectId","subjectId","references","imageAnnotationStatementCollection","segmentation","referencedSopInstanceUid","seriesInstanceUid","studyInstanceUid","imageAnnotation","segmentationEntityCollection","SegmentationEntity","person","sex","patientId","birthDate","id","equipment","manufacturerName","manufacturerModelName","softwareVersion","user","loginName","stringAim","JSON","stringify","wrappedAim","aimConf","uniqueIdentifier","dateTime","_createUser","_createEquipment","_createPerson","_createImageAnnotations","undefined","parse","data","enumAimType","seriesAnnotation","studyAnnotation","getImageIdAnnotations","aims","imageIdSpecificMarkups","parseAim","ImageAnnotationCollection","markupEntities","markupEntity","imageId","getMarkup","segmentationEntities","segmentationEntity","getSegmentation","markupUid","calculations","getCalculationEntitiesOfMarkUp","error","aimUid","markupType","twoDimensionSpatialCoordinateCollection","imageAnnotationStatements","getImageAnnotationStatements","statement","objectUniqueIdentifier","calculationUid","subjectUniqueIdentifier","calculationEntities","getCalculationEntities","calculation","parseCalculation","calcResult","calculationResultCollection","calculationDataCollection","calcValue","CalculationData","getAimImageData","string","getSingleImageData","createOfflineAimSegmentation","userInfo","seedData","getAimImageDataFromSeg","addUserToSeedData","segEntityData","getSegmentationEntityDataFromSeg","segStats","addSegmentationToAim","sessionStorage","getItem","segId","createSegmentationEntity","meanId","createImageAnnotationStatement","stdDevId","minId","maxId","volumeId","dataset","refImage","getRefImageFromSeg","ReferencedSOPInstanceUID","SeriesInstanceUID","StudyInstanceUID","SOPClassUID","SOPInstanceUID","StudyTime","StudyDate","AccessionNumber","ReferencedSeriesSequence","getSingleImageDataFromSeg","Manufacturer","ManufacturerModelName","SoftwareVersions","PatientSex","PatientName","PatientID","PatientBirthDate","firstFrame","Array","isArray","PerFrameFunctionalGroupsSequence","derivation","DerivationImageSequence","SourceImageSequence","ReferencedSOPClassUID"],"mappings":"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"}